(function(d,b){var a=function(g,i){var f=g,h;for(h in i){f=f.replace(i[h],h)}return f},c={" ":/[\xa0\u2002\u2003\u2009]/g,"*":/[\xb7]/g,"'":/[\u2018\u2019]/g,'"':/[\u201c\u201d]/g,"...":/[\u2026]/g,"-":/[\u2013]/g,"--":/[\u2014]/g,"&raquo;":/[\ufffd]/g};String.prototype.tidy=function(){a(this,c);return this};b.Decoda=function(h,g){var f=this;f.options={open:"[",close:"]",namespace:"",previewUrl:"",maxNewLines:3,submitFullFormOnPreview:false,onSubmit:null,onInsert:null,onInitialize:null,onRenderToolbar:null,onRenderPreview:null,onRenderHelp:null};f.collapse={collapseToEnd:"collapseToEnd",collapseToStart:"collapseToStart",select:"select"};f.editor=null;f.toolbar=null;f.textarea=null;f.form=null;f.container=null;f.preview=null;f.help=null;f.tags=[];f.init=function(j,i){d.extend(this.options,i);if(typeof j.jquery==="undefined"){this.textarea=d(j)}else{this.textarea=j}if(!this.textarea||this.textarea.length!==1){throw new Decoda.DecodaException("Too many elements")}if(this.textarea.prop("nodeName").toLowerCase()!=="textarea"){throw new Decoda.DecodaException("Textarea expected to be a textarea, got "+this.textarea.prop("nodeName"))}this.form=this.textarea.parents("form");this.editor=this.createElement("div","decoda-editor");this.toolbar=this.createElement("div","decoda-toolbars");this.container=this.createElement("div","decoda-textarea");this.preview=this.createElement("div","decoda-preview").hide();this.help=this.createElement("div","decoda-help").hide();this.help.data("render",false);this.textarea.wrap(this.container);this.container=this.textarea.parent();this.container.wrap(this.editor);this.editor=this.container.parent();this.container.before(this.toolbar).after(this.preview,this.help);if(typeof this.options.namespace==="string"&&this.options.namespace){this.editor.addClass(this.options.namespace)}if(d.isFunction(this.options.onSubmit)){this.form.bind("submit",d.proxy(this.options.onSubmit,this))}if(d.isFunction(this.options.onInitialize)){d.proxy(this.options.onInitialize,this)()}};f.createElement=function(j,i){var k=d(document.createElement(j));if(typeof i==="string"){k.addClass(i)}else{if(typeof i==="undefined"){}else{d.each(i,d.proxy(function(l,m){if(typeof m==="string"){this.addClass(m)}},k))}}return k};f.defaults=function(i){this.addFilters(null,null,i);this.addControls(null,null,i);return this};f.addControls=function(k,i,j){if(!i){d.each(Decoda.controls,d.proxy(function(m,l){this.addControls(m,l,j)},this))}else{this.buildToolbar(k,i,j)}return this};f.addFilters=function(k,j,i){if(!j){var l=d.extend({},Decoda.filters);delete l.email;delete l.url;delete l.image;delete l.video;d.each(l,d.proxy(function(n,m){this.addFilters(n,m,i)},this))}else{this.buildToolbar(k,j,i);d.each(j,d.proxy(function(n,m){this.tags.push(m)},this))}return this};f.buildToolbar=function(i,k,l){l=d.isArray(l)?l:[];var o=this.createElement("ul",["decoda-toolbar","toolbar-"+i]),q,n,j,m;d.each(k,d.proxy(function(s,t){if(l.indexOf(t.tag)>=0){return}q=this.createElement("li");n=this.createElement("button","tag-"+t.tag).html("<span></span>").attr({type:"button",title:t.title});n.bind("click",d.proxy(t.onClick||this.insertTag,this,t,n));if(t.key){n.attr("title",n.attr("title")+" (Ctrl + "+t.key.toUpperCase()+")");t.keyCode=t.key.toUpperCase().charCodeAt(0);this.textarea.bind("keydown",d.proxy(function(u){this._listenKeydown(u,t,n)},this))}if(t.className){n.addClass(t.className)}q.append(n);if(t.options){j=this.createElement("ul",["decoda-menu","menu-"+t.tag]);d.each(t.options,d.proxy(function(u,v){v=d.extend({},t,v);if(l.indexOf(v.tag)>=0){return}m=this.createElement("a").html("<span></span>"+v.title).attr("href","javascript:;").attr("title",v.title);m.bind("click",d.proxy(v.onClick||this.insertTag,this,v,m));if(v.className){m.addClass(v.className)}j.append(this.createElement("li").append(m))},this));q.append(j)}o.append(q)},this));if(o[0].hasChildNodes()){this.toolbar.append(o);if(this.help.data("render")){this.help.data("render",false)}if(d.isFunction(this.options.onRenderToolbar)){d.proxy(this.options.onRenderToolbar,this,o)()}}var r=this.toolbar.find(".decoda-toolbar"),p=r.length;r.each(function(s,t){d(t).css("zIndex",p);p--});return this};f.disableToolbar=function(){this.toolbar.find("button").each(function(i,j){d(j).prop("disabled",true).parents("li").addClass("disabled")});return this};f.enableToolbar=function(){this.toolbar.find("button").each(function(i,j){d(j).prop("disabled",false).parents("li").removeClass("disabled")});return this};f.clean=function(){var j=this.textarea.val(),i=this.options.maxNewLines;j=j.replace(/\r\n/g,"\n").replace(/\r/g,"\n");if(i){j=j.replace(new RegExp("\n{"+(i+1)+",}","g"),this.repeatString("\n",i))}j=j.trim();j=j.tidy();this.textarea.val(j);return this};f.repeatString=function(k,j){var i="";for(j;j>0;j--){i+=k}return i};f.insertTag=function(i){this.textarea.focus();var j,l=this.textarea.getSelection().text,n=i.promptFor||"default",m;if(i.prompt){m=prompt(i.prompt);if(m===null){return this}if(d.isFunction(i.onInsert)){m=d.proxy(i.onInsert,this,m,n)()}if(n==="default"){j=m}else{l=m}}var k=this.formatTag(i,j,l);if(this.textarea.getSelection().length>0){if(i.selfClose){this.textarea.replaceSelectedText(k,this.collapse.collapseToEnd)}else{this.textarea.replaceSelectedText(k)}}else{this.textarea.replaceSelectedText(k,this.collapse.collapseToEnd);if(!i.selfClose){var o=this.formatTag(i,j,l,"close");this.textarea.setSelection(this.textarea.getSelection().start-o.length)}}if(d.isFunction(this.options.onInsert)){d.proxy(this.options.onInsert,this,k)()}return this};f.formatTag=function(s,m,n,l){m=m||s.defaultValue||"";n=n||s.placeholder||"";var r=s.tag,i=this.options.open,k=this.options.close,j=i+r,q=i+"/"+r+k,p;if(s.hasDefault){p=s.promptFor||"default";if(s.prompt&&p==="default"){if(m){j+='="'+m+'"'}}else{j+='="'+m+'"'}}if(s.selfClose){return j+"/"+k}else{j+=k}if(l==="open"){return j}else{if(l==="close"){return q}}return j+n+q};f.renderHelp=function(){this.help.data("render",true);this.help.empty();var l=this.createElement("table"),n=this.createElement("thead"),k=this.createElement("tbody"),m,i,j;m=this.createElement("tr");m.append(this.createElement("th").html("Tag"),this.createElement("th").html("Attributes"),this.createElement("th").html("Examples"));n.append(m);d.each(this.tags,d.proxy(function(p,o){j=(o.attributes||[]).join(", ");i=(o.examples||[this.formatTag(o)]).join(", ");m=this.createElement("tr");m.append(this.createElement("td","tag-title").html(o.title),this.createElement("td","tag-attributes").html(j),this.createElement("td","tag-examples").html(i));k.append(m)},this));this.help.append(l.append(n,k));if(d.isFunction(this.options.onRenderHelp)){d.proxy(this.options.onRenderHelp,this,l)()}return this};f.renderPreview=function(){this.preview.addClass("loading");var i=!!(this.options.submitFullFormOnPreview&&(typeof this.form.attr("enctype")!=="undefined"&&this.form.attr("enctype")==="multipart/form-data"));d.ajax({url:this.options.previewUrl,type:"post",data:(this.options.submitFullFormOnPreview)?(i?new FormData(this.form[0]):this.form.serialize()):{input:this.textarea.val()},processData:!i,contentType:i?false:"application/x-www-form-urlencoded; charset=UTF-8",success:d.proxy(function(j){this.preview.removeClass("loading").html(j)},this),error:d.proxy(function(l,j,k){this.container.show();this.enableToolbar();this.preview.removeClass("visible").hide();alert("An error has occured while rendering the preview. Error : "+k)},this)});if(d.isFunction(this.options.onRenderPreview)){d.proxy(this.options.onRenderPreview,this)()}return this};f._listenKeydown=function(j,k,i){if(j.ctrlKey&&((typeof(j.key)!=="undefined"&&j.key===k.key)||(j.keyCode===k.keyCode))){j.stopPropagation();j.preventDefault();if(d.isFunction(k.onClick)){d.proxy(k.onClick,this,k,i)()}else{this.insertTag(k,i)}return false}};d.proxy(this.init,this,h,g)();return this};b.Decoda.filters={defaults:{b:{tag:"b",title:"Bold",key:"b"},i:{tag:"i",title:"Italics",key:"i"},u:{tag:"u",title:"Underline",key:"u"},s:{tag:"s",title:"Strike-Through",key:"s"},sub:{tag:"sub",title:"Subscript"},sup:{tag:"sup",title:"Superscript"},abbr:{tag:"abbr",title:"Abbreviation",hasDefault:true,prompt:"Title:",attributes:["default"],examples:['[abbr="Hyper-Text Markup Language"]HTML[/abbr]']},time:{tag:"time",title:"Timestamp",prompt:"Date:",promptFor:"content"},br:{tag:"br",title:"Line Break",selfClose:true},hr:{tag:"hr",title:"Horizontal Break",selfClose:true}},text:{font:{tag:"font",title:"Font Family",prompt:"Font:",hasDefault:true,attributes:["default"],examples:['[font="Arial"][/font]'],options:[{title:"Arial",defaultValue:"Arial",className:"font-arial",prompt:false},{title:"Tahoma",defaultValue:"Tahoma",className:"font-tahoma",prompt:false},{title:"Verdana",defaultValue:"Verdana",className:"font-verdana",prompt:false},{title:"Courier",defaultValue:"Courier",className:"font-courier",prompt:false},{title:"Times",defaultValue:"Times",className:"font-times",prompt:false},{title:"Helvetica",defaultValue:"Helvetica",className:"font-helvetica",prompt:false}]},size:{tag:"size",title:"Text Size",prompt:"Size:",hasDefault:true,attributes:["default"],examples:['[size="12"][/size]'],options:[{title:"Small",defaultValue:"10",className:"size-small",prompt:false},{title:"Normal",defaultValue:"12",className:"size-normal",prompt:false},{title:"Medium",defaultValue:"18",className:"size-medium",prompt:false},{title:"Large",defaultValue:"24",className:"size-large",prompt:false}],onInsert:function(g,h){if(h==="default"){var f=Number(g);if(!isNan(f)){return f<10?10:((f>29)?29:f)}return 12}return g}},color:{tag:"color",title:"Text Color",prompt:"Hex Code:",hasDefault:true,attributes:["default"],examples:['[color="red"][/color]'],options:[{title:"Yellow",defaultValue:"yellow",className:"color-yellow",prompt:false},{title:"Orange",defaultValue:"orange",className:"color-orange",prompt:false},{title:"Red",defaultValue:"red",className:"color-red",prompt:false},{title:"Blue",defaultValue:"blue",className:"color-blue",prompt:false},{title:"Purple",defaultValue:"purple",className:"color-purple",prompt:false},{title:"Green",defaultValue:"green",className:"color-green",prompt:false},{title:"White",defaultValue:"white",className:"color-white",prompt:false},{title:"Gray",defaultValue:"gray",className:"color-gray",prompt:false},{title:"Black",defaultValue:"black",className:"color-black",prompt:false}],onInsert:function(f,g){if(g==="default"){return(/(?:#[0-9a-f]{3,6}|[a-z]+)/i).exec(f)?f:null}return f}},heading:{tag:"h1",title:"Heading",examples:["[h1][/h1], [h2][/h2], [h3][/h3], [h4][/h4], [h5][/h5], [h6][/h6]"],options:[{tag:"h1",title:"1st",className:"heading-h1"},{tag:"h2",title:"2nd",className:"heading-h2"},{tag:"h3",title:"3rd",className:"heading-h3"},{tag:"h4",title:"4th",className:"heading-h4"},{tag:"h5",title:"5th",className:"heading-h5"},{tag:"h6",title:"6th",className:"heading-h6"}]}},block:{left:{tag:"left",title:"Left Align"},center:{tag:"center",title:"Center Align"},right:{tag:"right",title:"Right Align"},justify:{tag:"justify",title:"Justify Align"},hide:{tag:"hide",title:"Hide"},spoiler:{tag:"spoiler",title:"Spoiler"}},list:{list:{tag:"list",title:"Unordered List",examples:["[list][/list]",'[list="upper-alpha"][/list]'],attributes:["default <span>(optional)</span>"]},olist:{tag:"olist",title:"Ordered List",examples:["[olist][/olist]",'[olist="lower-roman"][/olist]'],attributes:["default <span>(optional)</span>"]},li:{tag:"li",title:"List Item"}},quote:{quote:{tag:"quote",title:"Quote Block",prompt:"Author:",hasDefault:true,examples:["[quote][/quote]",'[quote="Author"][/quote]','[quote date="12/12/2012"][/quote]'],attributes:["default <span>(optional)</span>","date <span>(optional)</span>"]}},code:{code:{tag:"code",title:"Code Block",examples:["[code][/code]",'[code="html"][/code]','[code hl="1,5,10"][/code]'],attributes:["default <span>(optional)</span>","hl <span>(optional)</span>"]},source:{tag:"source",title:"Code Snippet"},"var":{tag:"var",title:"Variable"}},email:{email:{tag:"email",title:"Email",prompt:"Email Address:",hasDefault:true,examples:["[email]email@domain.com[/email]",'[email="email@domain.com"][/email]'],attributes:["default <span>(optional)</span>"]}},url:{url:{tag:"url",title:"URL",prompt:"Web Address:",hasDefault:true,examples:["[url]http://domain.com[/url]",'[url="http://domain.com"][/url]'],attributes:["default <span>(optional)</span>"]}},image:{img:{tag:"img",title:"Image",prompt:"Image URL:",promptFor:"content",examples:["[img][/img]",'[img="200x200"][/img]','[img width="250" height="15%"][/img]'],attributes:["default <span>(optional)</span>","width <span>(optional)</span>","height <span>(optional)</span>","alt <span>(optional)</span>"]}},video:{video:{tag:"video",title:"Video",prompt:"Video ID:",promptFor:"content",hasDefault:true,examples:['[video="youtube"]ID[/video]','[youtube size="large"]ID[/youtube]','[veoh size="small"]ID[/veoh]'],attributes:["default","size <span>(optional)</span>"],options:[{tag:"youtube",title:"YouTube",hasDefault:false,className:"video-youtube"},{tag:"vimeo",title:"Vimeo",hasDefault:false,className:"video-vimeo"},{tag:"veoh",title:"Veoh",hasDefault:false,className:"video-veoh"},{tag:"vevo",title:"Vevo",hasDefault:false,className:"video-vevo"},{tag:"liveleak",title:"LiveLeak",hasDefault:false,className:"video-liveleak"},{tag:"dailymotion",title:"Daily Motion",hasDefault:false,className:"video-dailymotion"},{tag:"funnyordie",title:"Funny or Die",hasDefault:false,className:"video-funnyordie"},{tag:"collegehumor",title:"College Humor",hasDefault:false,className:"video-collegehumor"},{tag:"myspace",title:"MySpace",hasDefault:false,className:"video-myspace"},{tag:"wegame",title:"WeGame",hasDefault:false,className:"video-wegame"}]}},table:{table:{tag:"table",title:"Table",examples:["[table][/table]",'[table="sortable"][/table] <span>(class)</span>'],attributes:["default <span>(optional)</span>"]},thead:{tag:"thead",title:"Table Head"},tbody:{tag:"tbody",title:"Table Body"},tfoot:{tag:"tfoot",title:"Table Foot"},tr:{tag:"tr",title:"Table Row"},td:{tag:"td",title:"Table Cell",examples:["[td][/td]",'[td="3"][/td] <span>(colspan)</span>'],attributes:["default <span>(optional)</span>"]},th:{tag:"th",title:"Table Header",examples:["[th][/th]",'[th="3"][/th] <span>(colspan)</span>'],attributes:["default <span>(optional)</span>"]}}};b.Decoda.controls={editor:{preview:{tag:"preview",key:"e",title:"Preview",onClick:function(g,f){if(!this.options.previewUrl){alert("Preview functionality has not been enabled");return}this.container.hide();this.help.hide();if(this.preview.hasClass("visible")){this.preview.removeClass("visible").hide().empty();this.container.show();this.enableToolbar()}else{this.preview.addClass("visible").show();this.disableToolbar();this.renderPreview()}f.prop("disabled",false)}},clean:{tag:"clean",title:"Clean",onClick:function(g,f){this.disableToolbar();if(this.clean()){window.setTimeout(d.proxy(function(){this.enableToolbar()},this),500)}}},help:{tag:"help",title:"Help",onClick:function(g,f){if(!this.tags.length){alert("No tag filters have been loaded");return}this.container.hide();this.preview.hide();if(!this.help.data("render")){this.renderHelp()}if(this.help.hasClass("visible")){this.help.removeClass("visible").hide();this.container.show();this.enableToolbar()}else{this.help.addClass("visible").show();this.disableToolbar()}f.prop("disabled",false)}}}};b.Decoda.DecodaException=function(f){this.message=f};d.fn.decoda=function(f){var h=this;if(typeof this==="string"||(!this.jquery&&this.nodeType===1)){h=d(this)}if((!!h.jquery&&h.length>1)||d.isArray(h)){var g=[];if(!!h.jquery){h.each(function(j,k){var l=k.id||"decoda-id-"+(new Date()).getTime()+"-"+Math.floor((1+10000*Math.random()));g[l]=new Decoda(d(k).attr("id",l),f)})}else{var i;for(el in h){e=h[el];if(e.nodeType===1){i=e.id||"decoda-id-"+(new Date()).getTime()+"-"+Math.floor((1+10000*Math.random()));g[i]=new Decoda(d(e).attr("id",i),f)}}}return g}else{return new Decoda(h,f)}}})(jQuery,window);