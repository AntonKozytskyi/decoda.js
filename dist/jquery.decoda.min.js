(function(c){var a=function(e,g){var d=e,f;for(f in g){d=d.replace(g[f],f)}return d},b={" ":/[\xa0\u2002\u2003\u2009]/g,"*":/[\xb7]/g,"'":/[\u2018\u2019]/g,'"':/[\u201c\u201d]/g,"...":/[\u2026]/g,"-":/[\u2013]/g,"--":/[\u2014]/g,"&raquo;":/[\ufffd]/g};String.prototype.tidy=function(){a(this,b);return this};c.Decoda=function(f,e){var d=this;d.options={open:"[",close:"]",namespace:"",previewUrl:"",maxNewLines:3,onSubmit:null,onInsert:null,onInitialize:null,onRenderToolbar:null,onRenderPreview:null,onRenderHelp:null};d.collapse={collapseToEnd:"collapseToEnd",collapseToStart:"collapseToStart",select:"select"};d.editor=null;d.toolbar=null;d.textarea=null;d.form=null;d.container=null;d.preview=null;d.help=null;d.tags=[];d.init=function(h,g){c.extend(this.options,g);if(typeof h.jquery==="undefined"){this.textarea=c(h)}else{this.textarea=h}if(!this.textarea){throw new Exception("Invalid textarea")}this.form=this.textarea.parents("form");this.editor=this.createElement("div","decoda-editor");this.toolbar=this.createElement("div","decoda-toolbars");this.container=this.createElement("div","decoda-textarea");this.preview=this.createElement("div","decoda-preview").hide();this.help=this.createElement("div","decoda-help").hide();this.help.data("render",false);this.textarea.wrap(this.container);this.container=this.textarea.parent();this.container.wrap(this.editor);this.editor=this.container.parent();this.container.before(this.toolbar).after(this.preview,this.help);if(this.options.namespace){this.editor.addClass(this.options.namespace)}if(this.options.onSubmit){this.form.bind("submit",c.proxy(this.options.onSubmit,this))}if(c.isFunction(this.options.onInitialize)){c.proxy(this.options.onInitialize,this)()}};d.createElement=function(h,g){var i=c(document.createElement(h));if(typeof g==="string"){i.addClass(g)}else{if(typeof g==="undefined"){}else{c.each(g,c.proxy(function(j,k){this.addClass(k)},i))}}return i};d.defaults=function(g){this.addFilters(null,null,g);this.addControls(null,null,g);return this};d.addControls=function(i,g,h){if(!g){c.each(c.Decoda.controls,c.proxy(function(k,j){this.addControls(k,j,h)},this))}else{this.buildToolbar(i,g,h)}return this};d.addFilters=function(i,h,g){if(!h){var j=c.extend({},c.Decoda.filters);delete j.email;delete j.url;delete j.image;delete j.video;c.each(j,c.proxy(function(l,k){this.addFilters(l,k,g)},this))}else{this.buildToolbar(i,h,g);c.each(h,c.proxy(function(l,k){this.tags.push(k)},this))}return this};d.buildToolbar=function(g,i,j){j=c.isArray(j)?j:[];var m=this.createElement("ul",["decoda-toolbar","toolbar-"+g]),o,l,h,k;c.each(i,c.proxy(function(q,r){if(j.indexOf(r.tag)>=0){return}o=this.createElement("li");l=this.createElement("button","tag-"+r.tag).html("<span></span>").attr({type:"button",title:r.title});l.bind("click",c.proxy(r.onClick||this.insertTag,this,r,l));if(r.key){l.attr("title",l.attr("title")+" (Ctrl + "+r.key.toUpperCase()+")");r.keyCode=r.key.toUpperCase().charCodeAt(0);this.textarea.bind("keydown",c.proxy(function(s){this._listenKeydown(s,r,l)},this))}if(r.className){l.addClass(r.className)}o.append(l);if(r.options){h=this.createElement("ul",["decoda-menu","menu-"+r.tag]);c.each(r.options,c.proxy(function(s,t){t=c.extend({},r,t);if(j.indexOf(t.tag)>=0){return}k=this.createElement("a").html("<span></span>"+t.title).attr("href","javascript:;").attr("title",t.title);k.bind("click",c.proxy(t.onClick||this.insertTag,this,t,k));if(t.className){k.addClass(t.className)}h.append(this.createElement("li").append(k))},this));o.append(h)}m.append(o)},this));if(m[0].hasChildNodes()){this.toolbar.append(m);if(c.isFunction(this.options.onRenderToolbar)){c.proxy(this.options.onRenderToolbar,this,m)()}}var p=this.toolbar.find(".decoda-toolbar"),n=p.length;p.each(function(q,r){c(r).css("zIndex",n);n--});return this};d.disableToolbar=function(){this.toolbar.find("button").each(function(g,h){c(h).prop("disabled",true).parents("li").addClass("disabled")});return this};d.enableToolbar=function(){this.toolbar.find("button").each(function(g,h){c(h).prop("disabled",false).parents("li").removeClass("disabled")});return this};d.clean=function(){var h=this.textarea.val(),g=this.options.maxNewLines;h=h.replace(/\r\n/g,"\n").replace(/\r/g,"\n");if(g){h=h.replace(new RegExp("\n{"+(g+1)+",}","g"),this.repeatString("\n",g))}h=h.trim();h=h.tidy();this.textarea.val(h);return this};d.repeatString=function(i,h){var g="";for(h;h>0;h--){g+=i}return g};d.insertTag=function(g){this.textarea.focus();var h,j=this.textarea.getSelection().text,m=g.promptFor||"default",l,k;if(g.prompt){l=prompt(g.prompt);if(l===null){return this}if(c.isFunction(g.onInsert)){l=c.proxy(g.onInsert,this,l,m)()}if(m==="default"){h=l}else{j=l}}var i=this.formatTag(g,h,j);if(this.textarea.getSelection().length>0){if(g.selfClose){this.textarea.replaceSelectedText(i,this.collapse.collapseToEnd)}else{this.textarea.replaceSelectedText(i)}}else{this.textarea.replaceSelectedText(i,this.collapse.collapseToEnd);if(!g.selfClose){var n=this.formatTag(g,h,j,"close");this.textarea.setSelection(this.textarea.getSelection().start-n.length)}}if(c.isFunction(this.options.onInsert)){c.proxy(this.options.onInsert,this,i)()}return this};d.formatTag=function(q,k,l,j){k=k||q.defaultValue||"";l=l||q.placeholder||"";var p=q.tag,g=this.options.open,i=this.options.close,h=g+p,n=g+"/"+p+i,m;if(q.hasDefault){m=q.promptFor||"default";if(q.prompt&&m==="default"){if(k){h+='="'+k+'"'}}else{h+='="'+k+'"'}}if(q.selfClose){return h+"/"+i}else{h+=i}if(j==="open"){return h}else{if(j==="close"){return n}}return h+l+n};d.renderHelp=function(){this.help.data("render",true);var j=this.createElement("table"),l=this.createElement("thead"),i=this.createElement("tbody"),k,g,h;k=this.createElement("tr");k.append(this.createElement("th").html("Tag"),this.createElement("th").html("Attributes"),this.createElement("th").html("Examples"));l.append(k);c.each(this.tags,c.proxy(function(n,m){h=(m.attributes||[]).join(", ");g=(m.examples||[this.formatTag(m)]).join(", ");k=this.createElement("tr");k.append(this.createElement("td","tag-title").html(m.title),this.createElement("td","tag-attributes").html(h),this.createElement("td","tag-examples").html(g));i.append(k)},this));this.help.append(j.append(l,i));if(c.isFunction(this.options.onRenderHelp)){c.proxy(this.options.onRenderHelp,this,j)()}};d.renderPreview=function(){};d._listenKeydown=function(h,i,g){if(h.ctrlKey&&((typeof(h.key)!=="undefined"&&h.key===i.key)||(h.keyCode===i.keyCode))){h.stopPropagation();h.preventDefault();if(c.isFunction(i.onClick)){c.proxy(i.onClick,this,i,g)()}else{this.insertTag(i,g)}return false}};c.proxy(d.init,this,f,e)();return d};c.Decoda.filters={defaults:{b:{tag:"b",title:"Bold",key:"b"},i:{tag:"i",title:"Italics",key:"i"},u:{tag:"u",title:"Underline",key:"u"},s:{tag:"s",title:"Strike-Through",key:"s"},sub:{tag:"sub",title:"Subscript"},sup:{tag:"sup",title:"Superscript"},abbr:{tag:"abbr",title:"Abbreviation",hasDefault:true,prompt:"Title:",attributes:["default"],examples:['[abbr="Hyper-Text Markup Language"]HTML[/abbr]']},time:{tag:"time",title:"Timestamp",prompt:"Date:",promptFor:"content"},br:{tag:"br",title:"Line Break",selfClose:true},hr:{tag:"hr",title:"Horizontal Break",selfClose:true}},text:{font:{tag:"font",title:"Font Family",prompt:"Font:",hasDefault:true,attributes:["default"],examples:['[font="Arial"][/font]'],options:[{title:"Arial",defaultValue:"Arial",className:"font-arial",prompt:false},{title:"Tahoma",defaultValue:"Tahoma",className:"font-tahoma",prompt:false},{title:"Verdana",defaultValue:"Verdana",className:"font-verdana",prompt:false},{title:"Courier",defaultValue:"Courier",className:"font-courier",prompt:false},{title:"Times",defaultValue:"Times",className:"font-times",prompt:false},{title:"Helvetica",defaultValue:"Helvetica",className:"font-helvetica",prompt:false}]},size:{tag:"size",title:"Text Size",prompt:"Size:",hasDefault:true,attributes:["default"],examples:['[size="12"][/size]'],options:[{title:"Small",defaultValue:"10",className:"size-small",prompt:false},{title:"Normal",defaultValue:"12",className:"size-normal",prompt:false},{title:"Medium",defaultValue:"18",className:"size-medium",prompt:false},{title:"Large",defaultValue:"24",className:"size-large",prompt:false}],onInsert:function(e,f){if(f==="default"){var d=Number(e);if(!isNan(d)){return d<10?10:((d>29)?29:d)}return 12}return e}},color:{tag:"color",title:"Text Color",prompt:"Hex Code:",hasDefault:true,attributes:["default"],examples:['[color="red"][/color]'],options:[{title:"Yellow",defaultValue:"yellow",className:"color-yellow",prompt:false},{title:"Orange",defaultValue:"orange",className:"color-orange",prompt:false},{title:"Red",defaultValue:"red",className:"color-red",prompt:false},{title:"Blue",defaultValue:"blue",className:"color-blue",prompt:false},{title:"Purple",defaultValue:"purple",className:"color-purple",prompt:false},{title:"Green",defaultValue:"green",className:"color-green",prompt:false},{title:"White",defaultValue:"white",className:"color-white",prompt:false},{title:"Gray",defaultValue:"gray",className:"color-gray",prompt:false},{title:"Black",defaultValue:"black",className:"color-black",prompt:false}],onInsert:function(d,e){if(e==="default"){return(/(?:#[0-9a-f]{3,6}|[a-z]+)/i).exec(d)?d:null}return d}},heading:{tag:"h1",title:"Heading",examples:["[h1][/h1], [h2][/h2], [h3][/h3], [h4][/h4], [h5][/h5], [h6][/h6]"],options:[{tag:"h1",title:"1st",className:"heading-h1"},{tag:"h2",title:"2nd",className:"heading-h2"},{tag:"h3",title:"3rd",className:"heading-h3"},{tag:"h4",title:"4th",className:"heading-h4"},{tag:"h5",title:"5th",className:"heading-h5"},{tag:"h6",title:"6th",className:"heading-h6"}]}},block:{left:{tag:"left",title:"Left Align"},center:{tag:"center",title:"Center Align"},right:{tag:"right",title:"Right Align"},justify:{tag:"justify",title:"Justify Align"},hide:{tag:"hide",title:"Hide"},spoiler:{tag:"spoiler",title:"Spoiler"}},list:{list:{tag:"list",title:"Unordered List",examples:["[list][/list]",'[list="upper-alpha"][/list]'],attributes:["default <span>(optional)</span>"]},olist:{tag:"olist",title:"Ordered List",examples:["[olist][/olist]",'[olist="lower-roman"][/olist]'],attributes:["default <span>(optional)</span>"]},li:{tag:"li",title:"List Item"}},quote:{quote:{tag:"quote",title:"Quote Block",prompt:"Author:",hasDefault:true,examples:["[quote][/quote]",'[quote="Author"][/quote]','[quote date="12/12/2012"][/quote]'],attributes:["default <span>(optional)</span>","date <span>(optional)</span>"]}},code:{code:{tag:"code",title:"Code Block",examples:["[code][/code]",'[code="html"][/code]','[code hl="1,5,10"][/code]'],attributes:["default <span>(optional)</span>","hl <span>(optional)</span>"]},source:{tag:"source",title:"Code Snippet"},"var":{tag:"var",title:"Variable"}},email:{email:{tag:"email",title:"Email",prompt:"Email Address:",hasDefault:true,examples:["[email]email@domain.com[/email]",'[email="email@domain.com"][/email]'],attributes:["default <span>(optional)</span>"]}},url:{url:{tag:"url",title:"URL",prompt:"Web Address:",hasDefault:true,examples:["[url]http://domain.com[/url]",'[url="http://domain.com"][/url]'],attributes:["default <span>(optional)</span>"]}},image:{img:{tag:"img",title:"Image",prompt:"Image URL:",promptFor:"content",examples:["[img][/img]",'[img="200x200"][/img]','[img width="250" height="15%"][/img]'],attributes:["default <span>(optional)</span>","width <span>(optional)</span>","height <span>(optional)</span>","alt <span>(optional)</span>"]}},video:{video:{tag:"video",title:"Video",prompt:"Video ID:",promptFor:"content",hasDefault:true,examples:['[video="youtube"]ID[/video]','[youtube size="large"]ID[/youtube]','[veoh size="small"]ID[/veoh]'],attributes:["default","size <span>(optional)</span>"],options:[{tag:"youtube",title:"YouTube",hasDefault:false,className:"video-youtube"},{tag:"vimeo",title:"Vimeo",hasDefault:false,className:"video-vimeo"},{tag:"veoh",title:"Veoh",hasDefault:false,className:"video-veoh"},{tag:"vevo",title:"Vevo",hasDefault:false,className:"video-vevo"},{tag:"liveleak",title:"LiveLeak",hasDefault:false,className:"video-liveleak"},{tag:"dailymotion",title:"Daily Motion",hasDefault:false,className:"video-dailymotion"},{tag:"funnyordie",title:"Funny or Die",hasDefault:false,className:"video-funnyordie"},{tag:"collegehumor",title:"College Humor",hasDefault:false,className:"video-collegehumor"},{tag:"myspace",title:"MySpace",hasDefault:false,className:"video-myspace"},{tag:"wegame",title:"WeGame",hasDefault:false,className:"video-wegame"}]}},table:{table:{tag:"table",title:"Table",examples:["[table][/table]",'[table="sortable"][/table] <span>(class)</span>'],attributes:["default <span>(optional)</span>"]},thead:{tag:"thead",title:"Table Head"},tbody:{tag:"tbody",title:"Table Body"},tfoot:{tag:"tfoot",title:"Table Foot"},tr:{tag:"tr",title:"Table Row"},td:{tag:"td",title:"Table Cell",examples:["[td][/td]",'[td="3"][/td] <span>(colspan)</span>'],attributes:["default <span>(optional)</span>"]},th:{tag:"th",title:"Table Header",examples:["[th][/th]",'[th="3"][/th] <span>(colspan)</span>'],attributes:["default <span>(optional)</span>"]}}};c.Decoda.controls={editor:{preview:{tag:"preview",key:"e",title:"Preview",onClick:function(e,d){if(!this.options.previewUrl){alert("Preview functionality has not been enabled");return}this.container.hide();this.help.hide();if(this.preview.hasClass("visible")){this.preview.removeClass("visible").hide().empty();this.container.show();this.enableToolbar()}else{this.preview.addClass("visible").show();this.disableToolbar();this.renderPreview()}d.prop("disabled",false)}},clean:{tag:"clean",title:"Clean",onClick:function(e,d){this.disableToolbar();console.log(d);if(this.clean()){window.setTimeout(c.proxy(function(){this.enableToolbar()},this),500)}}},help:{tag:"help",title:"Help",onClick:function(e,d){if(!this.tags.length){alert("No tag filters have been loaded");return}this.container.hide();this.preview.hide();if(!this.help.data("render")){this.renderHelp()}if(this.help.hasClass("visible")){this.help.removeClass("visible").hide();this.container.show();this.enableToolbar()}else{this.help.addClass("visible").show();this.disableToolbar()}d.prop("disabled",false)}}}};c.fn.Decoda=function(d){return new c.Decoda(this,d)}})(jQuery);